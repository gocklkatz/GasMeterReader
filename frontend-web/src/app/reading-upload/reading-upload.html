<div class="upload-page">
  <h1 class="page-title">Gas Meter Reading</h1>
  <p class="page-subtitle">Upload one or more meter photos</p>

  <div class="card">
    <!-- Drop zone -->
    <div
      class="drop-zone"
      (dragover)="onDragOver($event)"
      (drop)="onDrop($event)"
      (click)="fileInput.click()"
    >
      <div class="drop-hint">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21 15 16 10 5 21"/>
        </svg>
        <p>Drag &amp; drop images here<br/>or <span class="link">click to browse</span></p>
        <p class="hint-small">JPEG, PNG, WEBP · multiple files supported</p>
      </div>
    </div>

    <input
      #fileInput
      type="file"
      accept="image/*"
      multiple
      class="hidden-input"
      (change)="onFileSelected($event)"
    />

    <!-- Entry list -->
    @if (entries().length > 0) {
      @if (hasPending()) {
        <button class="btn-submit" [disabled]="isAnyLoading()" (click)="submitAll()">
          @if (isAnyLoading()) {
            <span class="spinner"></span> Uploading…
          } @else {
            Upload {{ pendingCount() }} {{ pendingCount() === 1 ? 'image' : 'images' }}
          }
        </button>
      }

      <ul class="entry-list">
        @for (entry of entries(); track entry.file) {
          <li class="entry" [class.entry--done]="entry.result" [class.entry--error]="entry.error && !entry.loading">
            <div class="entry-thumb">
              @if (entry.preview) {
                <img [src]="entry.preview" alt="preview" />
              }
            </div>

            <div class="entry-details">
              <span class="entry-name">{{ entry.file.name }}</span>

              @if (!entry.result) {
                <input
                  type="datetime-local"
                  [value]="entry.timestamp"
                  (input)="updateTimestamp(entry, $any($event.target).value)"
                />
              }

              @if (entry.loading) {
                <span class="status status--loading"><span class="spinner"></span> Uploading…</span>
              }
              @if (entry.result) {
                <span class="status status--success">Saved · ID {{ entry.result.id }}</span>
              }
              @if (entry.error && !entry.loading) {
                <span class="status status--error">{{ entry.error }}</span>
              }
            </div>

            @if (!entry.loading && !entry.result) {
              <button class="btn-remove" (click)="removeEntry(entry)" aria-label="Remove">✕</button>
            }
          </li>
        }
      </ul>
    }
  </div>
</div>
